# 标注对象以供深度学习使用

ArcGIS Pro 3.1|其他版本|[ 帮助归档](https://pro.arcgis.com/zh-cn/pro-app/latest/get-started/archived-arcgis-pro-help.htm)

获得 Image Analyst 许可后可用。

需要 Spatial Analyst 许可。

所有监督深度学习任务取决于标注的数据集，这意味着用户必须运用自己具备的知识来训练神经网络了解其正在识别的内容。 神经网络将使用标注的对象来训练可用于对数据进行推断的模型。

图像注记或标注对于诸如计算机视觉和学习等深度学习任务至关重要。 要训练优质的深度学习模型，需要大量的标注数据。 在获得适当的训练数据后，深度学习系统在要素提取、模式识别和复杂问题解决方面会非常准确。 可使用**标注对象以供深度学习使用**窗格快速准确地标注数据。

**标注对象以供深度学习使用**按钮 ![标注对象以供深度学习使用](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-158841E8-3C6E-4224-A5E0-6BCCEF365979-web.png) 位于**影像**选项卡的**影像分类**组中的**分类工具**下拉菜单中。 该窗格分为两个部分。 窗格顶部用于管理类，窗格底部用于管理样本集合以及将训练数据导出到深度学习框架。

## 创建类和标注对象

可通过窗格的顶部来管理对象类，并手动创建用于训练深度学习模型的对象。 可使用许多可用工具帮助您创建标注对象。

#### 

| 工具                                                         | 函数                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![New Rectangle](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-AF77D0D4-DFC7-483E-9CCF-A37E3421C1FE-web.png) | 通过在栅格中围绕要素或对象绘制矩形来创建标注对象。           |
| ![New Polygon](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-FE323CDA-2800-4EA5-A8AA-81134E9F37DA-web.png) | 通过在栅格中围绕要素或对象绘制多边形来创建标注对象。         |
| ![New Circle](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-FE4598EF-D144-43EC-AC95-FF24946E2276-web.png) | 通过在栅格中围绕要素或对象绘制圆圈来创建标注对象。           |
| ![New Lasso Area](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-B8CBD8C6-D9D1-468C-A7D5-735A454D4456-web.png) | 通过在栅格中围绕要素或对象绘制手绘形状来创建标注对象。       |
| ![自动检测](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-358EBBE6-9DB7-4907-83F8-7F26065998EB-web.png) | 自动检测并标记要素或对象。 将围绕要素或对象绘制面。此工具仅在安装了深度学习框架库时可用。 |
| ![按多边形选择](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-45AE41DB-451E-465D-9036-C0576EC242C4-web.png) | 通过从分割图层中选择一个分割段来创建要素。 此选项仅对**内容**窗格中的分割图层可用。 在**内容**窗格中突出显示分割图层可激活**分割选取器**，然后从**分割选取器**下拉列表中选择图层。 |
| ![标注图像](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-36159B07-F005-42D9-BE3D-30E3A57D4CE8-web.png) | 将选定的类分配给当前图像。这仅在图像集合模式下可用。         |
| ![编辑](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-B84CE4F9-F22C-42D3-99C9-57009927672B-web.png) | 选择并编辑标注对象。                                         |
| ![新建模板](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-AC3A349F-42E4-4345-A529-54D38CBCAE84-web.png) | 创建分类方案。                                               |
| ![浏览](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-88B4450D-A188-447C-BDBA-280246319E1C-web.png) | 选择一个分类方案选项。浏览至现有方案。从现有的训练样本要素类生成新方案。从现有的已分类栅格生成新方案。使用默认的 2011 年国家土地覆被数据集方案。 |
| ![保存](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-FEADFA5A-A537-4078-8A98-3A963709CDD5-web.png) | 将更改保存至方案。                                           |
| ![保存编辑内容](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-8B9FC46E-3EFD-4475-A4E5-A72AB355D8D8-web.png) | 保存方案的新副本。                                           |
| ![添加](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-EAAB28C1-4940-4C69-AE27-3D13425F71BF-web.png) | 将类类别添加到方案。 首先选择方案的名称以在最高级别下创建父类。 选择现有类的名称以创建子类。 |
| ![删除所选项目](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-CCB3EAE8-10FD-4012-8356-328A19358555-web.png) | 从方案中移除所选类或子类类别。                               |

1. 单击草绘工具之一（例如**矩形**、**多边形**、**圆**或**手绘**）以开始收集对象样本。
2. 使用草绘工具，描绘在地图中表示对象的图像要素。
   1. 如果要创建未指定类的要素，将显示**定义类**对话框。 有关此对话框的详细信息，请参阅[定义类](https://pro.arcgis.com/zh-cn/pro-app/3.1/help/analysis/image-analyst/label-objects-for-deep-learning.htm#ESRI_SECTION2_589158582AA84715A2D29EEA5CCC1536)一节。
3. 继续如上述步骤所述创建和标注对象。
4. 可使用**标注对象**选项卡（位于窗格底部）删除和组织标注对象样本。
5. 所有标注对象令您满意后，单击**标注对象**选项卡上的**保存**按钮 ![保存](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-FEADFA5A-A537-4078-8A98-3A963709CDD5-web.png) 保存样本。

手动标注对象的代表性样本后，可使用这些样本导出训练数据。

### 自动检测

**自动检测**工具 ![自动检测](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-358EBBE6-9DB7-4907-83F8-7F26065998EB-web.png) 用于自动围绕要素绘制矩形 - 单击该要素将绘制矩形边界框。 如果需要要素的面边界，请按住 Shift 键并单击要素；这将围绕要素的形状绘制周长线。 要使该工具正常运行，需要在地图上显示大量要素像素，并且需要放大以靠近要素。

**自动检测**可以适用于不同的要素情况。 当您具有彼此非常接近的连续要素时，不建议使用该功能。

### 定义类

可通过**定义类**对话框创建新类或定义现有类。 如果选择**使用现有类**，则为该对象选择适当的**类名称**选项。 如果选择**添加新类**，则可以有选择地编辑信息，然后单击**确定**以创建新类。

### 标注影像集合

如果您有一组影像并且想要标记它们，则首先必须使用[镶嵌栅格](https://pro.arcgis.com/zh-cn/pro-app/3.1/help/analysis/raster-functions/mosaic-rasters.htm)函数创建[镶嵌数据集](https://pro.arcgis.com/zh-cn/pro-app/3.1/help/data/imagery/mosaic-datasets.htm)或镶嵌图层。 然后使用镶嵌数据集或镶嵌图层来标记每个影像。 **影像集**选项卡显示了图像的下拉列表。 所选图像将在地图中绘制。 您可随后使用合适的类标注图像。 使用箭头按钮选择下一个要查看和标注的图像。

当您的图像在图像坐标系 (ICS) 中时，图像可能处于不寻常的方向，尤其是在处理倾斜或透视图像时。 要在像素空间中查看图像，请选中**在像素空间中标注**复选框。 这将以更有利于直观解译影像的方向绘制图像。

#### 标注整个图像

例如，当您不想在对象周围绘制边界时，您可以使用**标注图像**按钮 ![标注图像](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-36159B07-F005-42D9-BE3D-30E3A57D4CE8-web.png) 用选定的类来标注整个图像，而不管对象的空间方面性质如何。

### 标注对象

**标注对象**选项卡位于窗格底部，用于管理为每个类收集的训练样本。 为图像中的每个类采集代表性地点或训练样本。 训练样本中具有位置信息（面）和关联类。 影像分类算法使用训练样本（另存为要素类）来识别整个影像中的土地覆被类。

您可以通过添加、分组或移除训练样本来对其进行查看和管理。 当您选中训练样本后，该样本将在地图上处于选中状态。 双击表中的训练样本以在地图中缩放。

#### 

| 工具                                                         | 函数                                 |
| ------------------------------------------------------------ | ------------------------------------ |
| ![浏览](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-88B4450D-A188-447C-BDBA-280246319E1C-web.png) | 打开现有的训练样本要素类。           |
| ![保存](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-FEADFA5A-A537-4078-8A98-3A963709CDD5-web.png) | 保存对当前标注对象要素类所做的编辑。 |
| ![保存编辑内容](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-8B9FC46E-3EFD-4475-A4E5-A72AB355D8D8-web.png) | 将当前标注对象另存为新要素类。       |
| ![删除所选项目](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/image-analyst/GUID-CCB3EAE8-10FD-4012-8356-328A19358555-web.png) | 删除选定标注对象。                   |

## 导出训练数据

收集样本后，可单击**导出训练数据**选项卡将其导出到训练数据中。 之后便可以将训练数据用于深度学习模型。 填写完参数后，单击**运行**以创建训练数据。

#### 

| 参数               | 描述                                                         |
| ------------------ | ------------------------------------------------------------ |
| **输出文件夹**     | 选择用于保存训练数据的输出文件夹。                           |
| **掩膜面要素**     | 此面要素类用于描绘将创建影像片的区域。系统仅会创建完全位于面内的影像片。 |
| **图像格式**       | 指定影像片输出的栅格格式。TIFF。 这是默认设置。MRF（元栅格格式）。PNG。JPEG。PNG 和 JPEG 格式最多支持 3 个波段。 |
| **分块大小 X**     | 影像片的大小，针对 x 维度。                                  |
| **分块大小 Y**     | 影像片的大小，针对 y 维度。                                  |
| **步幅 X**         | 在创建下一个影像片时 x 方向上移动的距离。当步幅等于切片大小时，将不会发生重叠。 当步幅等于切片大小的一半时，将有 50% 的重叠。 |
| **步幅 Y**         | 在创建下一个影像片时 y 方向上移动的距离。当步幅等于切片大小时，将不会发生重叠。 当步幅等于切片大小的一半时，将有 50% 的重叠。 |
| **旋转角度**       | 将用于生成其他影像片的旋转角度。 影像片将在旋转角度为 0 的情况下生成，这意味着无旋转。 随后系统将以指定的角度旋转该片，以创建其他影像片。 系统将在多个影像片中以多个角度捕获相同的训练样本，以便用于数据增强。 默认旋转角度为 0。 |
| **输出无要素切片** | 指定是否将导出不捕获训练样本的影像片。未选中 - 仅会导出捕获训练样本的影像片。 这是默认设置。选中 - 将导出所有影像片，包括不捕获训练样本的影像片。 |
| **元数据格式**     | 指定输出元数据标注使用的格式。如果输入训练样本数据是诸如建筑物图层等的要素类图层或者标准分类训练样本文件，请使用 **KITTI 标注** 或 **PASCAL Visual 对象类**选项（Python 中的 KITTI_rectangles 或 PASCAL_VOC_rectangles）。 输出元数据是包含训练样本数据的 .txt 文件或 .xml 文件，其中训练样本数据包含在最小外接矩形中。 元数据文件的名称与输入源影像名称相匹配。 如果输入训练样本数据是类地图，请使用**分类切片**选项（Python 中的 Classified_Tiles）作为输出元数据格式。KITTI 标注 - 元数据遵循与卡尔斯鲁厄理工学院和丰田工业大学 (KITTI) 对象检测评估数据集相同的格式。 KITTI 数据集是一款视觉基准套件。 标注文件是纯文本文件。 所有的值（数值和字符串）均由空格分隔开，每行对应一个对象。PASCAL 可视化对象类 - 元数据遵循与模式分析、统计建模和计算学习、可视化对象类 (PASCAL VOC) 数据集相同的格式。 PASCAL VOC 数据集是用于对象类识别的标准化影像数据集。 标注文件是 XML 文件，包含有关影像名称、类值和边界框的信息。 这是默认设置。分类切片 - 输出为每个输入影像片一个分类影像片。 不会使用每个影像片的任何其他元数据。 只有统计数据输出具有更多关于类的信息，如类名称、类值和输出统计数据。RCNN 掩膜 - 输出为在样本所在的区域上具有掩膜的影像片。 该模型将为影像中对象的每个实例生成边界框和分割掩膜。 这要基于特征金字塔网络 (FPN) 和深度学习框架模型中的 ResNet101 核心支柱。标注切片 - 每个输出切片都将使用特定类进行标注。 如果选择此元数据格式，则可以进一步优化**将周围要素变黑**和**裁剪模式**参数。多标注切片 - 每个输出切片都将使用一个或多个类进行标注。 例如，可将切片标注为“农业”，也可将其标注为“多云”。 此格式将用于对象分类。导出切片 - 输出将为不带标注的影像片。 此格式用于影像转换技术，例如 Pix2Pix 和超分辨率。CycleGAN - 输出将为不带标注的影像片。 此格式用于影像转换技术 CycleGAN，该技术可用于训练不重叠的影像。Imagenet - 每个输出切片都将使用特定类进行标注。 此格式用于对象分类；但是，在训练期间使用深度排序模型类型时，也可以用于对象追踪。对于 KITTI 元数据格式，将创建 15 个列，但此工具中仅使用其中 5 个列。 第一个列是类值。 然后，跳过之后 3 个列。 5 至 8 列用于定义最小外接矩形，该矩形将由以下 4 个影像坐标位置构成：左、上、右和下像素。 最小外接矩形包含用于深度学习分类器中的训练片。 系统将不会使用其他列。 |
| **将周围要素变黑** | 指定是否对每个影像切片中的每个对象或要素周围的像素进行掩膜。未选中 - 将不会对对象或要素周围的像素进行掩膜。 这是默认设置。选中 - 将对对象或要素周围的像素进行掩膜。仅当**元数据格式**参数设置为**标注切片**且已指定输入要素类或分类栅格时，此参数才适用。 |
| **裁剪模式**       | 指定是否将裁剪导出的切片，从而使其大小均相同。固定大小 - 导出的切片将具有相同的大小，并将以要素为中心。 这是默认设置。边界框 - 将对导出的切片进行裁剪，以使边界几何仅围绕切片中的要素。仅当**元数据格式**参数设置为**标注切片**或 **Imagenet** 且已指定输入要素类或分类栅格时，此参数才适用。 |
| **参考系统**       | 指定用于解释输入影像的参考系类型。 指定的参考系必须与训练深度学习模型所使用的参考系相匹配。地图空间 - 输入影像位于基于地图的坐标系中。 这是默认设置。像素空间 - 输入影像位于影像空间（行和列）中，没有旋转和畸变。 |
| **附加输入栅格**   | 影像转换方法的附加输入影像源。当**元数据格式**参数设置为**已分类切片**、**导出切片**或 **CycleGAN** 时，此参数有效。 |

现在可以将导出的训练数据用于深度学习模型。